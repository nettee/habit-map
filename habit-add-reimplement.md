# 重新实现 `habits/add` 路由功能

## 一、背景

目前的多步向导采用了双层 Context、按路由拆页、本地持久化等多重抽象，虽然功能完备，但样板代码过多、维护成本高。对于只有三步、业务流程固定的场景，这种「提前优化」反而增加了阅读和修改的难度。

## 二、架构建议

### 1. 单页面模式（推荐）
- 用一个顶层组件统一管理 `currentStep` 和向导数据（标题、微行为、提醒设置等）；
- 每个步骤拆成独立子组件，仅负责渲染表单内容和更新数据；
- 顶层组件负责进度指示、按钮渲染及路由跳转（可选）。

### 2. 多路由 + 单一 Context
- 保留 `/step1`、`/step2`、`/step3` 路由结构；
- 用一个轻量 Context 存储向导数据和当前步骤索引；
- 各页面只需 `useEffect(() => setStep(n), [])` 和前置数据校验；
- 布局组件直接读取 Context 来计算进度和按钮状态，无需第二层布局 Context。

## 三、技术选型

- **状态管理**：原生 `useState` + 最少量的 Context；
- **表单处理**：推荐 React Hook Form（配合 Zod/Yup 做 Schema 校验），减少重复校验逻辑；
- **网络请求**：直接调用 `fetch` 或者引入 SWR/React Query 做缓存和加载状态管理；
- **样式/UI**：继续使用 TailwindCSS + 可复用的 Button、ProgressIndicator 等基础组件。

## 四、实现思路

1. **数据模型设计**：
   - 定义一个包含 `title`、`description`、`behaviors`、`reminders` 的简单对象；
2. **导航和路由**：
   - 单页面：通过 `step` 渲染不同子组件；
   - 多路由：页面级 `useEffect` 做 `router.push` 和前置校验；
3. **表单校验**：
   - 每步校验集中在父组件或表单库中，通过校验结果控制"下一步"按钮的 `disabled`；
4. **进度与按钮**：
   - 根据当前 `step` 动态计算进度条比例和按钮文案，无需额外 Context；
5. **最终提交**：
   - 在最后一步点击"完成"时，将数据 `POST /api/habits`，并根据结果展示成功或错误提示；
6. **错误处理 & 加载态**：
   - 显示全局或局部的 Loading Spinner，捕获网络或校验错误并给出友好提示；

## 五、具体实施步骤

1. 新建或更新 `app/habits/add/page.tsx`（单页面）或 `app/habits/add/step[n]/page.tsx`（多路由）；
2. 定义顶层 `WizardData` 类型，初始化 `useState`；
3. 拆分 `Step1`、`Step2`、`Step3` 表单组件，传入 `data` 和 `setData`；
4. 实现进度指示器和导航按钮，根据校验结果控制可用性；
5. 调用后端 API 提交数据，并处理响应；
6. 根据实际复用场景，逐步抽象共享逻辑（Hook、组件）。

## 六、后续扩展

- 若向导流程增多或复用需求提升，可提炼 `useWizard` Hook；
- 抽取通用向导布局组件，并引入配置驱动；
- 国际化、多语言支持、可配置字段等。 